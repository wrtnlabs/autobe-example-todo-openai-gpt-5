/// Append-only audit trail capturing sensitive operations across the system.
/// Records the acting user (required), optional target user, business
/// action, related resource classification, outcome, and client context.
/// Private todo text values are never stored here. References actors and
/// targets via {@link todo_app_users} to support cross-user isolation and
/// governance reviews. Uses restrictive/set-null deletes to preserve audit
/// history.
///
/// @namespace Audit
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model todo_app_audit_logs {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Acting user's {@link todo_app_users.id}. Required for attribution and
  /// accountability.
  actor_user_id String
  
  /// Target user's {@link todo_app_users.id}. Optional when no specific user
  /// is targeted.
  target_user_id String?
  
  /// Business action identifier (e.g., "login", "logout", "suspend_account",
  /// "data_export_request"). Used for audit classification and search.
  action String
  
  /// Domain resource category or model name associated with the action (e.g.,
  /// "todo_app_todos", "todo_app_sessions").
  resource_type String?
  
  /// Identifier of the resource related to this event when applicable. String
  /// typed to accommodate non-UUID external identifiers.
  resource_id String?
  
  /// Whether the attempted action succeeded (true) or failed (false).
  success Boolean
  
  /// Origin IP address captured at the time of the event for security
  /// investigation. Stored as text.
  ip String?
  
  /// Client user-agent string to aid in security investigations. Text only; no
  /// parsing or PII extraction here.
  user_agent String?
  
  /// Record creation timestamp (event capture time).
  created_at DateTime
  
  /// Record last update timestamp (operational correction/audit enrichment
  /// time).
  updated_at DateTime
  
  /// Soft deletion timestamp for retention workflows. Null means
  /// active/retained.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  actorUser todo_app_users @relation("todo_app_audit_logs_of_actor_user_id", fields: [actor_user_id], references: [id], onDelete: Cascade)
  targetUser todo_app_users? @relation("todo_app_audit_logs_of_target_user_id", fields: [target_user_id], references: [id], onDelete: Cascade)
  
  @@index([actor_user_id, created_at])
  @@index([target_user_id, created_at])
  @@index([action, created_at])
  @@index([resource_type, created_at])
  @@index([created_at])
  @@index([resource_type, resource_id, created_at])
}

/// Historical records of privileged administrative operations performed by
/// system administrators. Captures who acted, optional target user, the
/// administrative action, stated reason, and operational notes. Does not
/// store private todo content. Supports governance reviews and incident
/// response. Uses restrictive/set-null deletes on FKs to preserve history.
///
/// @namespace Audit
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model todo_app_admin_actions {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Administrator actor's {@link todo_app_users.id}. Required for privileged
  /// actions.
  admin_user_id String
  
  /// Target user's {@link todo_app_users.id}. Optional for service-wide
  /// actions with no specific target.
  target_user_id String?
  
  /// Administrative action key (e.g., "suspend_account", "reactivate_account",
  /// "revoke_sessions", "update_service_config").
  action String
  
  /// Business reason provided by the administrator for this action. Human
  /// readable; avoid private todo text.
  reason String?
  
  /// Operational notes relevant to the action. Human readable; avoid private
  /// todo text.
  notes String?
  
  /// Whether the administrative action completed successfully.
  success Boolean
  
  /// Optional idempotency token to prevent accidental duplicate execution of
  /// the same admin action request.
  idempotency_key String?
  
  /// Record creation timestamp (action capture time).
  created_at DateTime
  
  /// Record last update timestamp (operational correction/audit enrichment
  /// time).
  updated_at DateTime
  
  /// Soft deletion timestamp for retention workflows. Null means
  /// active/retained.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  adminUser todo_app_users @relation("todo_app_admin_actions_of_admin_user_id", fields: [admin_user_id], references: [id], onDelete: Cascade)
  targetUser todo_app_users? @relation("todo_app_admin_actions_of_target_user_id", fields: [target_user_id], references: [id], onDelete: Cascade)
  
  @@unique([idempotency_key])
  @@index([admin_user_id, action, created_at])
  @@index([target_user_id, created_at])
  @@index([action, created_at])
  @@index([created_at])
}

/// Point-in-time records of account lifecycle changes for users (e.g.,
/// pending_verification → active, active → suspended, suspended → active).
/// Provides a complete historical trail for governance and incident
/// investigation. The admin attribution is optional for system-triggered
/// transitions. No private todo text is stored here. Uses
/// restrictive/set-null deletes to preserve history.
///
/// @namespace Audit
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model todo_app_account_status_changes {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Subject account's {@link todo_app_users.id}. Required for the status
  /// transition record.
  target_user_id String
  
  /// Administrator actor's {@link todo_app_users.id} when manually changed.
  /// Null for automated/system transitions.
  admin_user_id String?
  
  /// Previous account status value (e.g., "pending_verification", "active",
  /// "suspended", "deactivated").
  previous_status String
  
  /// New account status value (e.g., "active", "suspended", "deactivated").
  new_status String
  
  /// Business rationale for the transition. Human readable; avoid private todo
  /// text.
  business_reason String?
  
  /// Indicates whether this transition actually changed the stored status
  /// (false for a no-op attempt).
  has_effect Boolean
  
  /// Record creation timestamp (transition capture time).
  created_at DateTime
  
  /// Record last update timestamp (operational correction/audit enrichment
  /// time).
  updated_at DateTime
  
  /// Soft deletion timestamp for retention workflows. Null means
  /// active/retained.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  targetUser todo_app_users @relation("todo_app_account_status_changes_of_target_user_id", fields: [target_user_id], references: [id], onDelete: Cascade)
  adminUser todo_app_users? @relation("todo_app_account_status_changes_of_admin_user_id", fields: [admin_user_id], references: [id], onDelete: Cascade)
  
  @@index([target_user_id, created_at])
  @@index([admin_user_id, created_at])
  @@index([new_status, created_at])
  @@index([created_at])
}