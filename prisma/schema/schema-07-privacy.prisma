/// Records of user-initiated personal data export requests for compliance
/// and portability. Each row represents one export job for a specific user
/// with lifecycle timestamps and outcome details. The record references the
/// owner user via {@link todo_app_users}. Typical queries filter by user,
/// status, and creation time; administrators may audit exports across users.
/// No private todo content is stored here, only metadata and the download
/// link when available.
///
/// @namespace Privacy
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model todo_app_data_exports {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Owner user's {@link todo_app_users.id}.
  todo_app_user_id String
  
  /// Export job status (e.g., requested, processing, completed, failed,
  /// expired). Used for workflow and monitoring.
  status String
  
  /// Requested data export format (e.g., json, csv).
  export_format String
  
  /// Secure download URI for the prepared export archive when available. Null
  /// until export is ready or if failed.
  download_uri String?
  
  /// Size of the generated export archive in bytes, if completed.
  file_size_bytes Int?
  
  /// Checksum (e.g., SHA-256) of the exported archive to allow integrity
  /// verification. Stored as plain hex string.
  checksum String?
  
  /// Optional human-readable status or failure reason captured during
  /// processing. Useful for support and audit.
  status_message String?
  
  /// Timestamp when the export finished successfully (or when processing
  /// concluded).
  completed_at DateTime?
  
  /// Timestamp after which the download link is no longer valid.
  expires_at DateTime?
  
  /// IP address (string form) captured at the time of export request for
  /// traceability.
  request_ip String?
  
  /// User agent string captured at the time of export request for traceability.
  request_user_agent String?
  
  /// Creation timestamp (request time).
  created_at DateTime
  
  /// Last update timestamp for the export job record.
  updated_at DateTime
  
  /// Soft deletion timestamp. Allows operational recovery or retention
  /// handling per policy.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  user todo_app_users @relation(fields: [todo_app_user_id], references: [id], onDelete: Cascade)
  
  @@index([todo_app_user_id, created_at])
  @@index([status, created_at])
  @@index([expires_at, status])
  @@index([todo_app_user_id, status, created_at])
}

/// User-initiated account deletion workflow records. Each row captures a
/// single deletion request lifecycle including confirmations, scheduling,
/// finalization, or cancellation. References the account {@link
/// todo_app_users} and stores only administrative metadata and reasons (no
/// private content). Used by governance teams to track and enforce data
/// lifecycle policies.
///
/// @namespace Privacy
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model todo_app_account_deletion_requests {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Target account's {@link todo_app_users.id}.
  todo_app_user_id String
  
  /// Deletion request status (e.g., pending_confirmation, scheduled, canceled,
  /// completed).
  status String
  
  /// Optional user-provided reason or administrative note for the deletion
  /// request.
  reason String?
  
  /// Timestamp when the user confirmed the deletion request (e.g., via email).
  confirmed_at DateTime?
  
  /// Scheduled date/time for purge operations to begin, per policy.
  scheduled_purge_at DateTime?
  
  /// Timestamp when deletion processing completed for the account.
  processed_at DateTime?
  
  /// Timestamp when the request was canceled or withdrawn by the user.
  canceled_at DateTime?
  
  /// IP address (string form) captured at the time the deletion request was
  /// created.
  request_ip String?
  
  /// User agent string captured at request time.
  request_user_agent String?
  
  /// Creation timestamp for the deletion request.
  created_at DateTime
  
  /// Last update timestamp for the deletion request.
  updated_at DateTime
  
  /// Soft deletion timestamp for operational needs and retention controls.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  user todo_app_users @relation(fields: [todo_app_user_id], references: [id], onDelete: Cascade)
  
  @@index([todo_app_user_id, created_at], map: "todo_app_account_deletion_requests_todo_app_user_id_cr_21b3ed5e")
  @@index([status, created_at])
  @@index([scheduled_purge_at, status], map: "todo_app_account_deletion_requests_scheduled_purge_at__e6cc4b4d")
  @@index([todo_app_user_id, status, created_at], map: "todo_app_account_deletion_requests_todo_app_user_id_st_080b2833")
}

/// Consent records per user and purpose for non-essential processing. Each
/// row represents a specific consent action (granted or revoked) tied to a
/// policy version and timestamps. Historical trail is preserved by new rows
/// rather than updates in place. References the owner via {@link
/// todo_app_users}. Enables compliance queries by user, purpose, and status.
///
/// @namespace Privacy
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model todo_app_privacy_consents {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Owner user's {@link todo_app_users.id}.
  todo_app_user_id String
  
  /// System code for the consent purpose (e.g., analytics, marketing_email).
  /// Used for programmatic filtering.
  purpose_code String
  
  /// Human-readable purpose name for search and reporting.
  purpose_name String
  
  /// Whether consent was granted (true) or denied/withdrawn (false) at the
  /// event time.
  granted Boolean
  
  /// Timestamp when the consent action occurred (grant or deny).
  granted_at DateTime
  
  /// Timestamp when the previously granted consent was revoked. Null if still
  /// active or if never granted.
  revoked_at DateTime?
  
  /// Optional expiry for the consent if governed by policy.
  expires_at DateTime?
  
  /// Policy or notice version identifier that was in effect at the time of
  /// consent.
  policy_version String
  
  /// Where/how the consent was captured (e.g., web, mobile, settings_page).
  source String?
  
  /// IP address (string form) at the time of the consent action.
  ip String?
  
  /// User agent string at the time of the consent action.
  user_agent String?
  
  /// Record creation timestamp.
  created_at DateTime
  
  /// Last update timestamp for the record.
  updated_at DateTime
  
  /// Soft deletion timestamp for operational recovery/retention.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  user todo_app_users @relation(fields: [todo_app_user_id], references: [id], onDelete: Cascade)
  
  @@index([todo_app_user_id, purpose_code, granted_at], map: "todo_app_privacy_consents_todo_app_user_id_purpose_cod_6355176d")
  @@index([purpose_code, granted, created_at])
}